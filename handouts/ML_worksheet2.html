
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Classification Models &#8212; LeDataSciFi-2024</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/moviescript.css" />
    <link rel="stylesheet" type="text/css" href="../_static/frontpage.css" />
    <link rel="stylesheet" type="text/css" href="../_static/fin377_specialformatting.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script >const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">LeDataSciFi-2024</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent">
 <span class="caption-text">
  Syllabus
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../content/about/objectives.html">
   Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../content/about/outcomes.html">
   Outcomes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../content/about/about_us.html">
   About us + office hours
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../content/about/structure_and_policies.html">
   Course structure + policies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../content/about/use_of_gpt.html">
   ChatGPT and other AI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../content/about/gradeoverview.html">
   Grading
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../content/about/interest.html">
   Interested but unsure?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../content/about/bootcamp.html">
   Pre-Class Bootcamp
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../content/about/hall_of_awesomeness.html">
   The Hall of Awesomeness
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../content/about/acknowledgments.html">
   Gratitude
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Schedule, tips, resources
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../content/about/schedule.html">
   Dashboard, key links, schedule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../content/about/help.html">
   Help
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../content/about/resources.html">
   Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../content/about/tips.html">
   Tips and hacks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/LeDataSciFi/ledatascifi-2024/tree/main/community_codebook">
   Community Codebook
   <i class="fas fa-external-link-alt">
   </i>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/LeDataSciFi/ledatascifi-2024/tree/main/handouts">
   Class Handouts
   <i class="fas fa-external-link-alt">
   </i>
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Assignments and participation
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../content/assignments/howto_do.html">
   How to start and turn in assignments
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../content/assignments/howto_review.html">
   How to do your peer reviews
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../content/assignments/mid_proj.html">
   Midterm project AKA ASGN 5
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../content/assignments/website_setup.html">
   Personal Website AKA ASGN 9
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../content/assignments/project.html">
   Final projects
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Textbook
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../content/01/00_Getting_Started.html">
   1. Motivation and Getting Started
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../content/01/01_Motivation.html">
     1.1. Motivation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/01/02_Setup.html">
     1.2. Set up
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/01/03_github.html">
     1.3. GitHub Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/01/03a_githubworkflow.html">
     1.4. The GitHub Workflow
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/01/04_Markdown.html">
     1.5. Markdown basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/01/05_jupyterlab.html">
     1.6. Jupyter Lab Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/01/06_python.html">
     1.7. Python Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/01/07_debugging.html">
     1.8. Debugging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/01/07a_errors.html">
     1.9. Errors
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/01/08_libraries.html">
     1.10. Libraries/Packages
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/01/09_gitignore.html">
     1.11. Gitignore Files
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../content/02/10_Golden_1.html">
   2. Good Analysis Practices
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../content/02/10_Golden_2.html">
     2.1. A case study of bad research
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/02/10_Golden_3.html">
     2.2. The golden rules
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/02/10_Golden_6.html">
     2.3. Organizing your projects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/02/10_Golden_7.html">
     2.4. Filepaths
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/02/10_Golden_4.html">
     2.5. Storing data smartly
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/02/10_Golden_5a.html">
     2.6. Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/02/10_Golden_5b.html">
     2.7. Writing good code comments
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/02/10_Golden_8.html">
     2.8. Writing good code
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../content/03/00_Data_Wrangling_Intro.html">
   3. Wrangling with Data
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../content/03/01_Numpy.html">
     3.1. Numpy
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/01a_NumpyCS.html">
       3.1.1. Numpy + Scientific Computing
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/01b_NumpyBasics.html">
       3.1.2. A (Very) Short Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/01c_NumpyPractice.html">
       3.1.3. Exercises
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/01d_NumpyResources.html">
       3.1.4. More Resources
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../content/03/02a_pandasIntro.html">
     3.2. Pandas
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/02a_pandasTips.html">
       3.2.1. Tips
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/02b_pandasVocab.html">
       3.2.2. Vocab and Long vs Wide Data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/02c_commonFcns.html">
       3.2.3. Common Functions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/02d_temp.html">
       3.2.4. Temp. vs Perm. Objects
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/02e_eda_golden.html">
       3.2.5. Golden Rules + EDA
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/02f_chains.html">
       3.2.6. Pandas Chains
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/02g_commontasks.html">
       3.2.7. Common Tasks
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/02h_exercises.html">
       3.2.8. Exercises
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/02j_resourcesAndSum.html">
       3.2.9. Summary and Resources
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../content/03/04a-dataviz.html">
     3.3. Data Visualization
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/04b-whyplot.html">
       3.3.1. The Role of Viz in Analysis
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/04c-makeplot.html">
       3.3.2. Making a Plot
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/04d-whichplot.html">
       3.3.3. Which Plot Type Should I Use?
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/04e-visualEDA.html">
       3.3.4. Visual EDA Walkthrough
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/04e2-visualEDA-tools.html">
       3.3.5. Visual EDA Tools
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/04f1-viz_narrative.html">
       3.3.6. Better Plots
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/04f2-customizing_figs.html">
       3.3.7. Customizing figures
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/04f3-interactive_figs.html">
       3.3.8. Interactive plots:
       <code class="docutils literal notranslate">
        <span class="pre">
         plotly
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/04f4-exercises.html">
       3.3.9. Exercises
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/04h_Summary.html">
       3.3.10. Chapter Summary
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../content/03/05a-otherskills.html">
     3.4. Other (Important) Data Wrangling Skills
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/05b_merging.html">
       3.4.1. Merging
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/05c_missingdata.html">
       3.4.2. Dealing with Missing Data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/05d_outliers.html">
       3.4.3. Dealing with Outliers
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/03/05e_summary.html">
       3.4.4. Chapter Summary
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../content/04/00_World_Wide_Data.html">
   4. Building and Using Large (Textual) Data
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../content/04/01_Intro_to_scraping.html">
     4.1. Getting Data off the Web
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/04/01a_openingAndParsing.html">
     4.2. Opening + Parsing
     <em>
      a
     </em>
     Webpage
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/04/01b_spiders.html">
     4.3. Building a spider
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../content/04/02_strings.html">
     4.4. Exploiting Textual Data
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../content/04/02a_Python%20Strings.html">
       4.4.1. Working with Python Strings
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/04/02b_regex.html">
       4.4.2. Regex basics
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/04/02c_developing_a_regex.html">
       4.4.3. Developing a regex
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../content/04/02d_RegexApplication.html">
       4.4.4. Intro to NLP - The Anchor Phase Technique
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../content/05/00_intro.html">
   5. Data Science Intro
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/01_bigpicture.html">
     5.1. The promise of ML
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/01b_model_process.html">
     5.2. Planning a project
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/01a_MLgonewrong.html">
     5.3. ML Gone Wrong
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/01c_teams.html">
     5.4. Coding in Teams
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/01d_sharingBigFiles.html">
     5.5. Sharing large files
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../content/05/02_reg.html">
   6. Regression
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/02a_basics.html">
     6.1. Basics and Notation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/02b_mechanics.html">
     6.2. Mechanics of running regressions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/02c_goodnessOfFit.html">
     6.3. Goodness of Fit
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/02d_interpretingCoefs.html">
     6.4. Interpreting regression coefficients
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/02e_statisticalSig.html">
     6.5. Statistical significance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/02f_warnings.html">
     6.6.
     <em>
      Significant
     </em>
     warnings about “statistical significance”
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/02g_summary.html">
     6.7. Summary and Resources
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../content/05/03_ML.html">
   7. ML - Intro &amp; Discussion
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/03a_ML_obj_and_tradeoff.html">
     7.1. The objective of machine learning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/03f_leakage.html">
     7.2. Data Leakage - Illustration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/03f_leakage3.html">
     7.3. Data Leakage - Illustration 2
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/03f_leakage2.html">
     7.4. Data Leakage Defined
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/03c_ModelEval.html">
     7.5. Model evaluation via cross validation (CV)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/03c1_OOS.html">
     7.6. Model evaluation via Out-of-Sample (OOS)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/03d_whatToMax.html">
     7.7. Evaluating models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/03e_whichModel.html">
     7.8. Model selection
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../content/05/04a_SKLearn.html">
   8. ML - Code &amp; Implementation
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/04b_best_practices.html">
     8.1. Best Practice Pseudo Code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/04c_onemodel.html">
     8.2. SKLearn Intro
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/04d_crossval.html">
     8.3. Cross-Validation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/04e_pipelines.html">
     8.4. Pipelines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/04e1_preprocessing.html">
     8.5. Preprocessing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/04f_optimizing_a_model.html">
     8.6. Optimizing a Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/04h_putting_together.html">
     8.7. Many Models
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../content/05/05a_finapps.html">
   9. Finance Applications
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/05a_compounding.html">
     9.1. Compounding returns
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/05a_rolling.html">
     9.2. Rolling returns
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/05a_expanding.html">
     9.3. Expanding returns
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/05b_capm.html">
     9.4. Estimating CAPM
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/05c_factorloadings.html">
     9.5. Estimating better models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/05c_finpacks.html">
     9.6. Supercharged resources/packages
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../content/05/06_thefuture.html">
   10. The Future
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/06a_saving.html">
     10.1. Saving Your Work
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/06b_nextsteps.html">
     10.2. Faster, better, stronger
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../content/05/06c_dashboards.html">
     10.3. Dashboards
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Slides and Memes
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../content/slides/slides.html">
   Slides from previous classes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../content/slides/memes.html">
   Memes
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/handouts/ML_worksheet2.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/LeDataSciFi/ledatascifi-2024"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/LeDataSciFi/ledatascifi-2024/issues/new?title=Issue%20on%20page%20%2Fhandouts/ML_worksheet2.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/LeDataSciFi/ledatascifi-2024/edit/main/handouts/ML_worksheet2.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/LeDataSciFi/ledatascifi-2024/main?urlpath=lab/tree/handouts/ML_worksheet2.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/LeDataSciFi/ledatascifi-2024/blob/main/handouts/ML_worksheet2.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-data">
   Load data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-the-training-and-holdout-samples">
   Create the training and holdout samples
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-up-one-classification-model">
   Setting up
   <em>
    one
   </em>
   classification model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#evaluating-the-classification-model">
   Evaluating the classification model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#classification-report">
     Classification Report
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#confusion-matrix">
     Confusion Matrix
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calibration-display">
     Calibration display
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#precision-recall-curves">
     Precision-Recall Curves
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#roc-curve-receiver-operating-characteristic">
   ROC curve (“receiver operating characteristic”)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#detection-error-tradeoff-det">
     Detection error tradeoff (DET)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-problem-with-our-estimator-imbalance">
   The problem with our estimator: Imbalance
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#options-to-deal-with-imbalanced-data">
     Options to deal with imbalanced data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#practical-tips">
     🔥🔥🔥 Practical tips: 🔥🔥🔥
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#weighting-example">
     Weighting example
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   Exercises
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bonus-demo-undersampling">
   Bonus demo: Undersampling
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="classification-models">
<h1>Classification Models<a class="headerlink" href="#classification-models" title="Permalink to this headline">¶</a></h1>
<p>A <strong>classification model</strong> is when you’re predicting an outcome with discrete levels. It can be binary (default vs paid off), or multinomial (red, orange, yellow, green, blue, indigo, violet).</p>
<p>We actually estimated a classification model in the last worksheet: Did borrowers pay back a loan?</p>
<p>In this worksheet:</p>
<ul class="simple">
<li><p>[ ] Ways to evaluate classifications models</p>
<ul>
<li><p>You can output a classification report and 5 figures</p></li>
<li><p>You can use and interpret those outputs</p></li>
</ul>
</li>
<li><p>[ ] The problem of imbalanced data</p></li>
<li><p>[ ] Thinking about the objective: what to maximize and/or minimize in your model</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">df_after_transform</span> <span class="kn">import</span> <span class="n">df_after_transform</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">set_config</span>
<span class="kn">from</span> <span class="nn">sklearn.calibration</span> <span class="kn">import</span> <span class="n">CalibrationDisplay</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ColumnTransformer</span><span class="p">,</span>
    <span class="n">make_column_selector</span><span class="p">,</span>
    <span class="n">make_column_transformer</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ConfusionMatrixDisplay</span><span class="p">,</span>
    <span class="n">DetCurveDisplay</span><span class="p">,</span>
    <span class="n">PrecisionRecallDisplay</span><span class="p">,</span>
    <span class="n">RocCurveDisplay</span><span class="p">,</span>
    <span class="n">classification_report</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">GridSearchCV</span><span class="p">,</span>
    <span class="n">KFold</span><span class="p">,</span>
    <span class="n">cross_validate</span><span class="p">,</span>
    <span class="n">train_test_split</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">StandardScaler</span>

<span class="n">set_config</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s2">&quot;diagram&quot;</span><span class="p">)</span>  <span class="c1"># display=&#39;text&#39; is the default</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span>
    <span class="s2">&quot;display.max_colwidth&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;display.max_rows&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;display.max_columns&quot;</span><span class="p">,</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="load-data">
<h2>Load data<a class="headerlink" href="#load-data" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">loans</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;inputs/2013_subsample.zip&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="create-the-training-and-holdout-samples">
<h2>Create the training and holdout samples<a class="headerlink" href="#create-the-training-and-holdout-samples" title="Permalink to this headline">¶</a></h2>
<p>Here, we will use <code class="docutils literal notranslate"><span class="pre">test_train_split</span></code>, though this might not</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># first let&#39;s separate y from X (as is typically done)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">loans</span><span class="o">.</span><span class="n">loan_status</span> <span class="o">==</span> <span class="s2">&quot;Charged Off&quot;</span>
<span class="n">y</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">loans</span> <span class="o">=</span> <span class="n">loans</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;loan_status&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># stratify will make sure that test/train both have equal fractions of outcome</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">loans</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="setting-up-one-classification-model">
<h2>Setting up <em>one</em> classification model<a class="headerlink" href="#setting-up-one-classification-model" title="Permalink to this headline">¶</a></h2>
<p><em>Note: <code class="docutils literal notranslate"><span class="pre">preproc_pipe</span></code> is the exact same as last time, but I’ve defined it in a different (easier?) way, and I’ve named the whole pipeline <code class="docutils literal notranslate"><span class="pre">clf_logit</span></code></em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set up pipeline to clean each type of variable (1 pipe per var type)</span>

<span class="n">numer_pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">),</span> <span class="n">StandardScaler</span><span class="p">())</span>

<span class="n">cat_pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">))</span>

<span class="c1"># combine those (make_column_transformer is like make_pipeline, maybe easier on the eyes!)</span>

<span class="n">preproc_pipe</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">numer_pipe</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;annual_inc&quot;</span><span class="p">,</span> <span class="s2">&quot;int_rate&quot;</span><span class="p">]),</span>
    <span class="p">(</span><span class="n">cat_pipe</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;grade&quot;</span><span class="p">]),</span>
    <span class="n">remainder</span><span class="o">=</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># estimator</span>

<span class="n">clf_logit</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preproc_pipe</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>I’m going to fit it to the whole training dataset. This means what we’re about to learn is being done without CV for now, and will likely result in overconfident performance metrics.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf_logit</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-b3b9273a-8f78-427a-904b-a2919a2425dc {color: black;background-color: white;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc pre{padding: 0;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-toggleable {background-color: white;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-estimator:hover {background-color: #d4ebff;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-item {z-index: 1;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-parallel-item:only-child::after {width: 0;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-b3b9273a-8f78-427a-904b-a2919a2425dc div.sk-text-repr-fallback {display: none;}</style><div id="sk-b3b9273a-8f78-427a-904b-a2919a2425dc" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;pipeline-1&#x27;,
                                                  Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                                   SimpleImputer()),
                                                                  (&#x27;standardscaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;annual_inc&#x27;, &#x27;int_rate&#x27;]),
                                                 (&#x27;pipeline-2&#x27;,
                                                  Pipeline(steps=[(&#x27;onehotencoder&#x27;,
                                                                   OneHotEncoder(drop=&#x27;first&#x27;))]),
                                                  [&#x27;grade&#x27;])])),
                (&#x27;logisticregression&#x27;, LogisticRegression())])</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="87fabb66-8912-4a06-b282-21b6779be089" type="checkbox" ><label for="87fabb66-8912-4a06-b282-21b6779be089" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;pipeline-1&#x27;,
                                                  Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                                   SimpleImputer()),
                                                                  (&#x27;standardscaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;annual_inc&#x27;, &#x27;int_rate&#x27;]),
                                                 (&#x27;pipeline-2&#x27;,
                                                  Pipeline(steps=[(&#x27;onehotencoder&#x27;,
                                                                   OneHotEncoder(drop=&#x27;first&#x27;))]),
                                                  [&#x27;grade&#x27;])])),
                (&#x27;logisticregression&#x27;, LogisticRegression())])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6eae5f52-4d31-4f9f-b8e5-d07813322e34" type="checkbox" ><label for="6eae5f52-4d31-4f9f-b8e5-d07813322e34" class="sk-toggleable__label sk-toggleable__label-arrow">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;pipeline-1&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer()),
                                                 (&#x27;standardscaler&#x27;,
                                                  StandardScaler())]),
                                 [&#x27;annual_inc&#x27;, &#x27;int_rate&#x27;]),
                                (&#x27;pipeline-2&#x27;,
                                 Pipeline(steps=[(&#x27;onehotencoder&#x27;,
                                                  OneHotEncoder(drop=&#x27;first&#x27;))]),
                                 [&#x27;grade&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ab545e3e-7358-486f-b27e-fd3e66b84cba" type="checkbox" ><label for="ab545e3e-7358-486f-b27e-fd3e66b84cba" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-1</label><div class="sk-toggleable__content"><pre>[&#x27;annual_inc&#x27;, &#x27;int_rate&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2dc49c3a-cff1-49a2-b2c7-5367f8442e9a" type="checkbox" ><label for="2dc49c3a-cff1-49a2-b2c7-5367f8442e9a" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a3cecde4-5f3d-449b-b55c-1067aa72e92f" type="checkbox" ><label for="a3cecde4-5f3d-449b-b55c-1067aa72e92f" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="add98c94-3ad8-45df-870b-0733c6228b20" type="checkbox" ><label for="add98c94-3ad8-45df-870b-0733c6228b20" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-2</label><div class="sk-toggleable__content"><pre>[&#x27;grade&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="1aca3b46-a788-4179-97e8-2d92579a76d2" type="checkbox" ><label for="1aca3b46-a788-4179-97e8-2d92579a76d2" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(drop=&#x27;first&#x27;)</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6bc9f02e-41ae-4482-991b-2e6d8e76111d" type="checkbox" ><label for="6bc9f02e-41ae-4482-991b-2e6d8e76111d" class="sk-toggleable__label sk-toggleable__label-arrow">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression()</pre></div></div></div></div></div></div></div></div></div>
</div>
</div>
<div class="section" id="evaluating-the-classification-model">
<h2>Evaluating the classification model<a class="headerlink" href="#evaluating-the-classification-model" title="Permalink to this headline">¶</a></h2>
<div class="section" id="classification-report">
<h3>Classification Report<a class="headerlink" href="#classification-report" title="Permalink to this headline">¶</a></h3>
<p><strong>The first thing you should do with a classification model is output a <code class="docutils literal notranslate"><span class="pre">classification_report</span></code>.</strong></p>
<p><em>Ignore the Warnings. This table is correct. It’s just mad that our model is so bad we never predict a default!</em></p>
<p>The definition of precision and recall and f1-score <a class="reference external" href="https://ledatascifi.github.io/ledatascifi-2022/content/05/03d_whatToMax.html">are here.</a></p>
<ul class="simple">
<li><p>Precision measures: When we predict an outcome, how often does that happen? (Are the predictions precise?)</p></li>
<li><p>Recall: What fraction of an outcome’s occurrences does your model detect? (“Does the model recall the true occurrences?”)</p>
<ul>
<li><p>Aka sensitivity: A sensitive model detects an outcome happening more often?</p></li>
</ul>
</li>
<li><p>Accuracy: Fraction of labels that are correct across all observations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">macro_avg</span></code>: Simple average of the stats above the blank line.</p>
<ul>
<li><p>The average of the precision in the False and True observations here (0.84 and 0) is 0.42</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">weighted_avg</span></code>: Average of the stats above the blank line, weighted by the number of observations in each outcome type</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> 
                            <span class="n">clf_logit</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              precision    recall  f1-score   support

       False       0.84      1.00      0.92     91024
        True       0.00      0.00      0.00     16819

    accuracy                           0.84    107843
   macro avg       0.42      0.50      0.46    107843
weighted avg       0.71      0.84      0.77    107843
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\DonsLaptop\anaconda3\lib\site-packages\sklearn\metrics\_classification.py:1318: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
C:\Users\DonsLaptop\anaconda3\lib\site-packages\sklearn\metrics\_classification.py:1318: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
C:\Users\DonsLaptop\anaconda3\lib\site-packages\sklearn\metrics\_classification.py:1318: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="confusion-matrix">
<h3>Confusion Matrix<a class="headerlink" href="#confusion-matrix" title="Permalink to this headline">¶</a></h3>
<p><strong>You should also output a Confusion Matrix, which is a standard way to display how a classifier is doing.</strong></p>
<ul class="simple">
<li><p>If you add <code class="docutils literal notranslate"><span class="pre">normalize='pred'</span></code> to the function below, the diagonal elements are your precisions.</p></li>
<li><p>If you add <code class="docutils literal notranslate"><span class="pre">normalize='true'</span></code> to the function below, the diagonal elements are your recalls.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ConfusionMatrixDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span><span class="n">clf_logit</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;sklearn.metrics._plot.confusion_matrix.ConfusionMatrixDisplay at 0x1d95d6f7a90&gt;
</pre></div>
</div>
<img alt="../_images/ML_worksheet2_13_11.png" src="../_images/ML_worksheet2_13_11.png" />
</div>
</div>
</div>
<div class="section" id="calibration-display">
<h3>Calibration display<a class="headerlink" href="#calibration-display" title="Permalink to this headline">¶</a></h3>
<p>Our logit estimator produces, for each loan, a prediction of the probability of default. A calibration display groups those predictions into buckets (on the x-axis), and reports the average true outcomes for that bucket (on the y-axis). A perfectly calibrated classifier will be on the 45 degree line.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CalibrationDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span><span class="n">clf_logit</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;sklearn.calibration.CalibrationDisplay at 0x1d965a312b0&gt;
</pre></div>
</div>
<img alt="../_images/ML_worksheet2_15_11.png" src="../_images/ML_worksheet2_15_11.png" />
</div>
</div>
<p>This figure suggests that our logit seems to be decently “calibrated”, even though it is performing AWFULLY in terms of precision and recall on predicting defaults.</p>
<p>Indeed, the logit model is producing predictions that are exactly equal to the average in the data! Look:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf_logit</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_train</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.156
</pre></div>
</div>
</div>
</div>
<p>What gives?</p>
<p>Here’s what happens:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">==============================================================================</span>
<span class="sd">          A flow chart from our model to the final predictions:</span>
<span class="sd">==============================================================================</span>

<span class="sd">logit     &gt;      ahat,           &gt;             yhat           &gt;         {0,1}</span>
<span class="sd">                 bhat                        Pr(y=1|X)</span>
<span class="sd">      ----------        --------------------           --------------</span>
<span class="sd">      | .fit() |        | .predict_proba() |           | .predict() |</span>
<span class="sd">      |        |        |  uses ahat bhat  |           |   uses  ?  |</span>
<span class="sd">      ----------        --------------------           --------------</span>

<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;\n==============================================================================\n          A flow chart from our model to the final predictions:\n==============================================================================\n\nlogit     &gt;      ahat,           &gt;             yhat           &gt;         {0,1}\n                 bhat                        Pr(y=1|X)\n      ----------        --------------------           --------------\n      | .fit() |        | .predict_proba() |           | .predict() |\n      |        |        |  uses ahat bhat  |           |   uses  ?  |\n      ----------        --------------------           --------------\n\n&#39;
</pre></div>
</div>
</div>
</div>
<p>That last step uses a <strong>“decision function”</strong> that maps the yhat values (predicted probabilities) into predictions.</p>
<p>To simplify a bit, the <strong>“default threshold”</strong> in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> for logit is 0.5:</p>
<ul class="simple">
<li><p>If yhat&gt;0.5: predict outcome = 1</p></li>
<li><p>Else: predict outcome = 0</p></li>
</ul>
<p><strong>You don’t need to use the default threshold! The threshold is a choice a researcher needs to make, as it involves important tradeoffs.</strong></p>
<p>In practice, how you make the choice depends on whether your business problem has larger costs for false positives, false negative, or larger benefits for true positives and true negatives.</p>
<p>The next set of diagnostics help you see how changing the threshold can change the performance of the model and assess these tradeoffs.</p>
</div>
<div class="section" id="precision-recall-curves">
<h3>Precision-Recall Curves<a class="headerlink" href="#precision-recall-curves" title="Permalink to this headline">¶</a></h3>
<p>This takes all the predicted probabilities the model produces, and pretends we set a threshold of 0.01, 0.02, … 0.99. For each possible threshold, compute the precision and recall of the predictions, and then plot them all.</p>
<p>In general, this curve will be sloped downwards <strong>because precision and recall are a tradeoff:</strong></p>
<ul class="simple">
<li><p>As you increase the threshold, you’ll reduce false positives (more precision) because you only predict default for loans you’re very confident will default</p></li>
<li><p>But as you increase the threshold, you’ll predict fewer defaults, meaning you’ll miss some. This will result in lower recall stats.</p></li>
</ul>
<p>The ideal model is the one closest to the upper right corner. (Ouch!)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PrecisionRecallDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span><span class="n">clf_logit</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;sklearn.metrics._plot.precision_recall_curve.PrecisionRecallDisplay at 0x1d9659fe130&gt;
</pre></div>
</div>
<img alt="../_images/ML_worksheet2_23_11.png" src="../_images/ML_worksheet2_23_11.png" />
</div>
</div>
</div>
</div>
<div class="section" id="roc-curve-receiver-operating-characteristic">
<h2>ROC curve (“receiver operating characteristic”)<a class="headerlink" href="#roc-curve-receiver-operating-characteristic" title="Permalink to this headline">¶</a></h2>
<p>This takes all the predicted probabilities the model produces, and pretends we set a threshold of 0.01, 0.02, … 0.99. For each possible threshold, compute the FPR and the TPR.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RocCurveDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span><span class="n">clf_logit</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;sklearn.metrics._plot.roc_curve.RocCurveDisplay at 0x1d965cb0670&gt;
</pre></div>
</div>
<img alt="../_images/ML_worksheet2_25_11.png" src="../_images/ML_worksheet2_25_11.png" />
</div>
</div>
<ul class="simple">
<li><p>This curve shows that you can alter the threshold to reduce false positives, but at the cost of missing some true positives.</p></li>
<li><p>The perfect estimator is the upper left corner.</p></li>
<li><p>Different estimators will have differently shaped curves, and the closer it gets to the upper left hand corner, the better.</p></li>
<li><p><strong>“AUC”</strong> reports the area under the curve. 1 is a perfect estimator and 0.5 is a random guess.</p></li>
</ul>
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/13/Roc_curve.svg/768px-Roc_curve.svg.png"  style="width:50%;"> 
<div class="section" id="detection-error-tradeoff-det">
<h3>Detection error tradeoff (DET)<a class="headerlink" href="#detection-error-tradeoff-det" title="Permalink to this headline">¶</a></h3>
<p>This takes all the predicted probabilities the model produces, and pretends we set a threshold of 0.01, 0.02, … 0.99. For each possible threshold, compute the FPR and the FNR and plot them.</p>
<p>The perfect estimator is the lower left corner of the chart. (Ouch!)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DetCurveDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span><span class="n">clf_logit</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;sklearn.metrics._plot.det_curve.DetCurveDisplay at 0x1d965d4ba60&gt;
</pre></div>
</div>
<img alt="../_images/ML_worksheet2_28_11.png" src="../_images/ML_worksheet2_28_11.png" />
</div>
</div>
</div>
</div>
<div class="section" id="the-problem-with-our-estimator-imbalance">
<h2>The problem with our estimator: Imbalance<a class="headerlink" href="#the-problem-with-our-estimator-imbalance" title="Permalink to this headline">¶</a></h2>
<p>The issue that is causing this problem is something that is rampant in real business settings: <strong>“Imbalanced classes.”</strong></p>
<p>Meaning: We have 85% and 15% for our two classes (paid off and charged off) instead of 50/50.</p>
<p>Imbalance causes problems with many (though not all) ML estimators.</p>
<p>By default, <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> treats both outcomes as equally important to predict, which is why it favors the majority class (and always predicts no default).</p>
<div class="section" id="options-to-deal-with-imbalanced-data">
<h3>Options to deal with imbalanced data<a class="headerlink" href="#options-to-deal-with-imbalanced-data" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>Change estimator to “weight” groups equally</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">class-weight=’balanced’</span></code> in tree models and logit</p></li>
<li><p>Is “like” oversampling, except no slowdown</p></li>
</ul>
</li>
<li><p>Remove data (meaning: undersample overrepresented group)</p>
<ul class="simple">
<li><p>Throws data away (hurts predictions!) but estimations faster</p></li>
<li><p>Tradeoff can be worth it: more speed and possibly similar or better predictions</p></li>
</ul>
</li>
<li><p>Add data (meaning: oversample underrepresented group)</p>
<ul class="simple">
<li><p>Slower estimations (more data)</p></li>
</ul>
</li>
</ol>
</div>
<div class="section" id="practical-tips">
<h3>🔥🔥🔥 Practical tips: 🔥🔥🔥<a class="headerlink" href="#practical-tips" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>What works best varies between applications (no “dominant”)</p></li>
<li><p><strong>Try weighting if estimator will let you, then undersampling</strong></p></li>
</ul>
</div>
<div class="section" id="weighting-example">
<h3>Weighting example<a class="headerlink" href="#weighting-example" title="Permalink to this headline">¶</a></h3>
<p>Denying a loan to a good customer is not as bad as giving a loan to a bad customer that defaults. You should probably <em>weigh</em> defaults more heavily.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">LogisticRegression()</span></code> model has a parameter that lets you decide how you weigh the class’s importance. You can manually specific them, but <code class="docutils literal notranslate"><span class="pre">LogisticRegression(class_weight='balanced')</span></code> will cause the minority class to be considered equally important overall. (Maybe you want to weigh even more, which you can do by manually setting the weights.)</p>
<p>So, I’m going to change the pipeline to use that parameter:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf_logit</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span> <span class="c1"># looking for the name of the parameter, as the pipeline cals it</span>
<span class="n">clf_logit</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">logisticregression__class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-ab587608-6809-444f-bceb-9328acb1c04a {color: black;background-color: white;}#sk-ab587608-6809-444f-bceb-9328acb1c04a pre{padding: 0;}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-toggleable {background-color: white;}#sk-ab587608-6809-444f-bceb-9328acb1c04a label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-ab587608-6809-444f-bceb-9328acb1c04a label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-ab587608-6809-444f-bceb-9328acb1c04a label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-ab587608-6809-444f-bceb-9328acb1c04a input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-ab587608-6809-444f-bceb-9328acb1c04a input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-ab587608-6809-444f-bceb-9328acb1c04a input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-estimator:hover {background-color: #d4ebff;}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-item {z-index: 1;}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-parallel-item:only-child::after {width: 0;}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-ab587608-6809-444f-bceb-9328acb1c04a div.sk-text-repr-fallback {display: none;}</style><div id="sk-ab587608-6809-444f-bceb-9328acb1c04a" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;pipeline-1&#x27;,
                                                  Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                                   SimpleImputer()),
                                                                  (&#x27;standardscaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;annual_inc&#x27;, &#x27;int_rate&#x27;]),
                                                 (&#x27;pipeline-2&#x27;,
                                                  Pipeline(steps=[(&#x27;onehotencoder&#x27;,
                                                                   OneHotEncoder(drop=&#x27;first&#x27;))]),
                                                  [&#x27;grade&#x27;])])),
                (&#x27;logisticregression&#x27;,
                 LogisticRegression(class_weight=&#x27;balanced&#x27;))])</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5d364db7-5f23-4b15-aa5a-16cfa3a90dae" type="checkbox" ><label for="5d364db7-5f23-4b15-aa5a-16cfa3a90dae" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;pipeline-1&#x27;,
                                                  Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                                   SimpleImputer()),
                                                                  (&#x27;standardscaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;annual_inc&#x27;, &#x27;int_rate&#x27;]),
                                                 (&#x27;pipeline-2&#x27;,
                                                  Pipeline(steps=[(&#x27;onehotencoder&#x27;,
                                                                   OneHotEncoder(drop=&#x27;first&#x27;))]),
                                                  [&#x27;grade&#x27;])])),
                (&#x27;logisticregression&#x27;,
                 LogisticRegression(class_weight=&#x27;balanced&#x27;))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="58793d17-57bf-4900-b2cc-9290d42af8be" type="checkbox" ><label for="58793d17-57bf-4900-b2cc-9290d42af8be" class="sk-toggleable__label sk-toggleable__label-arrow">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;pipeline-1&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer()),
                                                 (&#x27;standardscaler&#x27;,
                                                  StandardScaler())]),
                                 [&#x27;annual_inc&#x27;, &#x27;int_rate&#x27;]),
                                (&#x27;pipeline-2&#x27;,
                                 Pipeline(steps=[(&#x27;onehotencoder&#x27;,
                                                  OneHotEncoder(drop=&#x27;first&#x27;))]),
                                 [&#x27;grade&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d6dd07e7-ebfa-4246-8439-481e8dfe90db" type="checkbox" ><label for="d6dd07e7-ebfa-4246-8439-481e8dfe90db" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-1</label><div class="sk-toggleable__content"><pre>[&#x27;annual_inc&#x27;, &#x27;int_rate&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="bcbf2bf9-8466-4da4-b931-eb5246462b56" type="checkbox" ><label for="bcbf2bf9-8466-4da4-b931-eb5246462b56" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="cb5e89d6-9c25-42e7-93ea-195694f97eff" type="checkbox" ><label for="cb5e89d6-9c25-42e7-93ea-195694f97eff" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="96e836de-7bbc-4227-bcad-e1c8931e1bc7" type="checkbox" ><label for="96e836de-7bbc-4227-bcad-e1c8931e1bc7" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-2</label><div class="sk-toggleable__content"><pre>[&#x27;grade&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="84aa5d65-c8b5-41af-876e-c5cc65e0258c" type="checkbox" ><label for="84aa5d65-c8b5-41af-876e-c5cc65e0258c" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(drop=&#x27;first&#x27;)</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b2d8562a-aba7-40ae-bbce-be8bfb4e64a1" type="checkbox" ><label for="b2d8562a-aba7-40ae-bbce-be8bfb4e64a1" class="sk-toggleable__label sk-toggleable__label-arrow">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(class_weight=&#x27;balanced&#x27;)</pre></div></div></div></div></div></div></div></div></div>
</div>
<p>Now we can use it. How did we do?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf_logit</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> 
                            <span class="n">clf_logit</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              precision    recall  f1-score   support

       False       0.91      0.57      0.70     91024
        True       0.23      0.69      0.34     16819

    accuracy                           0.59    107843
   macro avg       0.57      0.63      0.52    107843
weighted avg       0.80      0.59      0.65    107843
</pre></div>
</div>
</div>
</div>
<p>Hey! We managed to actually predict some defaults!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ConfusionMatrixDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span><span class="n">clf_logit</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;sklearn.metrics._plot.confusion_matrix.ConfusionMatrixDisplay at 0x1d965dacfd0&gt;
</pre></div>
</div>
<img alt="../_images/ML_worksheet2_35_11.png" src="../_images/ML_worksheet2_35_11.png" />
</div>
</div>
</div>
</div>
<div class="section" id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<p>Make (reasonable) assumptions as needed to compare the two models:</p>
<ol class="simple">
<li><p>How much money does this improved model save us relative to the prior model from reduced charge-offs?</p></li>
<li><p>How much foregone profit does this “improved” model have relative to the prior model?</p></li>
<li><p>How does this improved model do from the standpoint of a profit maximizing lender? Meaning: Would you rather use the first or the second model, and why?</p></li>
<li><p>Write down a profit function for firm using the cells of the confusion matrix. (The four cells of the matrix are TNR, TPR, FNR, and FPR.)</p></li>
<li><p>Based on your profit function, which metric(s) do you want to maximize/minimize in this model? There might not be a clean answer, if so: Discuss candidates and what they capture correctly about the profit function and what they miss.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># put answers here</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="bonus-demo-undersampling">
<h2>Bonus demo: Undersampling<a class="headerlink" href="#bonus-demo-undersampling" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># !pip install -U imbalanced-learn</span>

<span class="kn">from</span> <span class="nn">imblearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span> <span class="k">as</span> <span class="n">make_pipeline_with_sampler</span>
<span class="kn">from</span> <span class="nn">imblearn.under_sampling</span> <span class="kn">import</span> <span class="n">RandomUnderSampler</span>

<span class="n">logit_undersamp</span> <span class="o">=</span> <span class="n">make_pipeline_with_sampler</span><span class="p">(</span>
    <span class="n">preproc_pipe</span><span class="p">,</span>
    <span class="n">RandomUnderSampler</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="n">LogisticRegression</span><span class="p">(),</span>
<span class="p">)</span>

<span class="n">logit_undersamp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span> 

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">logit_undersamp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">,)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./handouts"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Prof. Donald Bowen<br/>
        
            &copy; Copyright 2024.<br/>
          <div class="extra_footer">
            You're doing well, keep going!
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>