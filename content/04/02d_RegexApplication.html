
<!DOCTYPE html>

<html>
  <head>
   <!-- Global site tag (gtag.js) - Google Analytics -->
   <script async src="https://www.googletagmanager.com/gtag/js?id=G-QHB6CBHE8P"></script>
   <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QHB6CBHE8P');
   </script>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>4.4.4. Intro to NLP - The Anchor Phase Technique &#8212; LeDataSciFi-2024</title>
    
  <link rel="stylesheet" href="../../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/moviescript.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/frontpage.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/fin377_specialformatting.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script >const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="5. Data Science for Finance" href="../05/00_intro.html" />
    <link rel="prev" title="4.4.3. Developing a regex" href="02c_developing_a_regex.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">LeDataSciFi-2024</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent">
 <span class="caption-text">
  Syllabus
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../about/objectives.html">
   Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/outcomes.html">
   Outcomes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/about_us.html">
   About us + office hours
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/structure_and_policies.html">
   Course structure + policies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/use_of_gpt.html">
   ChatGPT and other AI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/gradeoverview.html">
   Grading
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/interest.html">
   Interested but unsure?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/bootcamp.html">
   Pre-Class Bootcamp
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/hall_of_awesomeness.html">
   The Hall of Awesomeness
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/acknowledgments.html">
   Gratitude
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Schedule, tips, resources
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../about/schedule.html">
   Dashboard, key links, schedule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/help.html">
   Help
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/resources.html">
   Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/tips.html">
   Tips and hacks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/LeDataSciFi/ledatascifi-2024/tree/main/community_codebook">
   Community Codebook
   <i class="fas fa-external-link-alt">
   </i>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/LeDataSciFi/ledatascifi-2024/tree/main/handouts">
   Class Handouts
   <i class="fas fa-external-link-alt">
   </i>
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Assignments and participation
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../assignments/howto_do.html">
   How to start and turn in assignments
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../assignments/howto_review.html">
   How to do your peer reviews
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../assignments/mid_proj.html">
   Midterm project AKA ASGN 5
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../assignments/website_setup.html">
   Personal Website AKA ASGN 9
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../assignments/project.html">
   Final projects
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Textbook
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../01/00_Getting_Started.html">
   1. Motivation and Getting Started
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../01/01_Motivation.html">
     1.1. Motivation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/02_Setup.html">
     1.2. Set up
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/03_github.html">
     1.3. GitHub Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/03a_githubworkflow.html">
     1.4. The GitHub Workflow
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/04_Markdown.html">
     1.5. Markdown basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/05_jupyterlab.html">
     1.6. Jupyter Lab Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/06_python.html">
     1.7. Python Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/07_debugging.html">
     1.8. Debugging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/07a_errors.html">
     1.9. Errors
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/08_libraries.html">
     1.10. Libraries/Packages
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/09_gitignore.html">
     1.11. Gitignore Files
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../02/10_Golden_1.html">
   2. Good Analysis Practices
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../02/10_Golden_2.html">
     2.1. A case study of bad research
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/10_Golden_3.html">
     2.2. The golden rules
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/10_Golden_6.html">
     2.3. Organizing your projects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/10_Golden_7.html">
     2.4. Filepaths
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/10_Golden_4.html">
     2.5. Storing data smartly
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/10_Golden_5a.html">
     2.6. Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/10_Golden_5b.html">
     2.7. Writing good code comments
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/10_Golden_8.html">
     2.8. Writing good code
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../03/00_Data_Wrangling_Intro.html">
   3. Wrangling with Data
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../03/01_Numpy.html">
     3.1. Numpy
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../03/01a_NumpyCS.html">
       3.1.1. Numpy + Scientific Computing
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/01b_NumpyBasics.html">
       3.1.2. A (Very) Short Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/01c_NumpyPractice.html">
       3.1.3. Exercises
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/01d_NumpyResources.html">
       3.1.4. More Resources
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../03/02a_pandasIntro.html">
     3.2. Pandas
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../03/02a_pandasTips.html">
       3.2.1. Tips
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/02b_pandasVocab.html">
       3.2.2. Vocab and Long vs Wide Data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/02c_commonFcns.html">
       3.2.3. Common Functions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/02d_temp.html">
       3.2.4. Temp. vs Perm. Objects
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/02e_eda_golden.html">
       3.2.5. Golden Rules + EDA
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/02f_chains.html">
       3.2.6. Pandas Chains
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/02g_commontasks.html">
       3.2.7. Common Tasks
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/02h_exercises.html">
       3.2.8. Exercises
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/02j_resourcesAndSum.html">
       3.2.9. Summary and Resources
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../03/04a-dataviz.html">
     3.3. Data Visualization
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../03/04b-whyplot.html">
       3.3.1. The Role of Viz in Analysis
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/04c-makeplot.html">
       3.3.2. Making a Plot
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/04d-whichplot.html">
       3.3.3. Which Plot Type Should I Use?
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/04e-visualEDA.html">
       3.3.4. Visual EDA Walkthrough
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/04e2-visualEDA-tools.html">
       3.3.5. Visual EDA Tools
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/04f1-viz_narrative.html">
       3.3.6. Better Plots
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/04f2-customizing_figs.html">
       3.3.7. Customizing figures
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/04f3-interactive_figs.html">
       3.3.8. Interactive plots:
       <code class="docutils literal notranslate">
        <span class="pre">
         plotly
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/04f4-exercises.html">
       3.3.9. Exercises
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/04h_Summary.html">
       3.3.10. Chapter Summary
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../03/05a-otherskills.html">
     3.4. Other (Important) Data Wrangling Skills
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../03/05b_merging.html">
       3.4.1. Merging
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/05c_missingdata.html">
       3.4.2. Dealing with Missing Data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/05d_outliers.html">
       3.4.3. Dealing with Outliers
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/05e_summary.html">
       3.4.4. Chapter Summary
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 current active collapsible-parent">
  <a class="reference internal" href="00_World_Wide_Data.html">
   4. Building and Using Large (Textual) Data
  </a>
  <ul class="current collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="01_Intro_to_scraping.html">
     4.1. Getting Data off the Web
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01a_openingAndParsing.html">
     4.2. Opening + Parsing
     <em>
      a
     </em>
     Webpage
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01b_spiders.html">
     4.3. Building a spider
    </a>
   </li>
   <li class="toctree-l2 current active collapsible-parent">
    <a class="reference internal" href="02_strings.html">
     4.4. Exploiting Textual Data
    </a>
    <ul class="current collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="02a_Python%20Strings.html">
       4.4.1. Working with Python Strings
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="02b_regex.html">
       4.4.2. Regex basics
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="02c_developing_a_regex.html">
       4.4.3. Developing a regex
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       4.4.4. Intro to NLP - The Anchor Phase Technique
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../05/00_intro.html">
   5. Data Science Intro
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../05/01_bigpicture.html">
     5.1. The promise of ML
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/01b_model_process.html">
     5.2. Planning a project
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/01a_MLgonewrong.html">
     5.3. ML Gone Wrong
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/01c_teams.html">
     5.4. Coding in Teams
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/01d_sharingBigFiles.html">
     5.5. Sharing large files
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../05/02_reg.html">
   6. Regression
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../05/02a_basics.html">
     6.1. Basics and Notation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/02b_mechanics.html">
     6.2. Mechanics of running regressions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/02c_goodnessOfFit.html">
     6.3. Goodness of Fit
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/02d_interpretingCoefs.html">
     6.4. Interpreting regression coefficients
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/02e_statisticalSig.html">
     6.5. Statistical significance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/02f_warnings.html">
     6.6.
     <em>
      Significant
     </em>
     warnings about “statistical significance”
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/02h_summary_colFE.html">
     6.7. Fixed effects, categorical variables, and prettier regression tables
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/02g_summary.html">
     6.8. Summary and Resources
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../05/03_ML.html">
   7. ML - Intro &amp; Discussion
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../05/03a_ML_obj_and_tradeoff.html">
     7.1. The objective of machine learning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/03f_leakage.html">
     7.2. Data Leakage - Illustration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/03f_leakage3.html">
     7.3. Data Leakage - Illustration 2
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/03f_leakage2.html">
     7.4. Data Leakage Defined
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/03c_ModelEval.html">
     7.5. Model evaluation via cross validation (CV)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/03c1_OOS.html">
     7.6. Model evaluation via Out-of-Sample (OOS)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/03d_whatToMax.html">
     7.7. Evaluating models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/03e_whichModel.html">
     7.8. Model selection
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../05/04a_SKLearn.html">
   8. ML - Code &amp; Implementation
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../05/04b_best_practices.html">
     8.1. Best Practice Pseudo Code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/04c_onemodel.html">
     8.2. SKLearn Intro
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/04d_crossval.html">
     8.3. Cross-Validation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/04e_pipelines.html">
     8.4. Pipelines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/04e1_preprocessing.html">
     8.5. Preprocessing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/04f_optimizing_a_model.html">
     8.6. Optimizing a Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/04h_putting_together.html">
     8.7. Many Models
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../05/05a_finapps.html">
   9. Finance Applications
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../05/05a_compounding.html">
     9.1. Compounding returns
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/05a_rolling.html">
     9.2. Rolling returns
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/05a_expanding.html">
     9.3. Expanding returns
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/05b_capm.html">
     9.4. Estimating CAPM
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/05c_factorloadings.html">
     9.5. Estimating better models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/05c_finpacks.html">
     9.6. Supercharged resources/packages
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../05/06_thefuture.html">
   10. The Future
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../05/06a_saving.html">
     10.1. Saving Your Work
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/06b_nextsteps.html">
     10.2. Faster, better, stronger
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/06c_dashboards.html">
     10.3. Dashboards
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Slides and Memes
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../slides/slides.html">
   Slides from previous classes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../slides/memes.html">
   Memes
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/content/04/02d_RegexApplication.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/LeDataSciFi/ledatascifi-2024"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/LeDataSciFi/ledatascifi-2024/issues/new?title=Issue%20on%20page%20%2Fcontent/04/02d_RegexApplication.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/LeDataSciFi/ledatascifi-2024/edit/main/content/04/02d_RegexApplication.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/LeDataSciFi/ledatascifi-2024/main?urlpath=lab/tree/content/04/02d_RegexApplication.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/LeDataSciFi/ledatascifi-2024/blob/main/content/04/02d_RegexApplication.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#demo">
   4.4.4.1. Demo
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tips">
   4.4.4.2. Tips
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#caveats">
   4.4.4.3. Caveats
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#practice">
   4.4.4.4. Practice
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="intro-to-nlp-the-anchor-phase-technique">
<h1><span class="section-number">4.4.4. </span>Intro to NLP - The Anchor Phase Technique<a class="headerlink" href="#intro-to-nlp-the-anchor-phase-technique" title="Permalink to this headline">¶</a></h1>
<p>Congrats on surviving the last few pages on regex. I’m guessing either you’re asleep, giving up on regex, or you are struggling to keep your eyes from glazing over.</p>
<p><a class="reference external" href="https://www.google.com/search?&amp;tbm=isch&amp;q=regex+memes">That’s natural! No one really likes or understands regex. I mean, the memes are good… and vicious.</a> But the prior two pages give you some background that will help you understand how to use a key function (<code class="docutils literal notranslate"><span class="pre">NEAR_regex</span></code>) we are going to use.</p>
<p><strong>Here is what’s going on:</strong></p>
<ol class="simple">
<li><p>We can collect a TON of webpages (documents). These pages have text and information we’d like to use.</p></li>
<li><p>But hiring employees to manually extract that info is expensive at scale. Python code and computer runtime is cheap.</p></li>
<li><p>NLP - natural language processing - is a field concerned with turning text into usable datasets. The field is advanced and has many powerful and cool methods.</p></li>
<li><p>“Anchor phrase” is a simple yet powerful technique. The basic idea is to look for a word (or words) near another word (or words) to see if (and how much) a document is discussing some topic. _Are you discussing <strong>risk</strong> in the context of <strong>supply chain</strong> issues?”</p></li>
<li><p>I wrote a function - <code class="docutils literal notranslate"><span class="pre">NEAR_regex()</span></code> - to do anchor phrase searches. It leverages the power of regex while <em>moooostly</em> hiding us from the necessary work of writing a dang regex.</p></li>
<li><p>The prior two pages were still useful because they give you necessary background that will help you understand how to use this function.</p></li>
<li><p>Again, this function means you won’t need to write a regex pattern!<a class="footnote-reference brackets" href="#best" id="id1">1</a></p></li>
</ol>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>“Anchor phrase” is also called “chained context discovery”.</p>
</div>
<p>The <a class="reference external" href="https://github.com/LeDataSciFi/ledatascifi-2024/tree/main/community_codebook">community codebook</a> (a valuable resource!) has a file in it called “near_regex.py”. To get that file to the folder you’re working on that needs the function (e.g., your class notes folder, and the assignment) you have two options:</p>
<ol class="simple">
<li><p>If you already cloned the textbook’s repo (good job, you!), then the file is already on your computer. Simply find it inside <code class="docutils literal notranslate"><span class="pre">ledatascifi-2024/community_codebook/</span></code> and copy it, then paste to the folder where it is needed.</p></li>
<li><p><a class="reference external" href="https://raw.githubusercontent.com/LeDataSciFi/ledatascifi-2024/main/community_codebook/near_regex.py">Clicking on the filename in the above link, then the “Raw” button will get you to this page</a>. If you right-click on the page and then select “Save Page As” (or similar, depending on your browser), you can put it in the folder where it is needed.</p></li>
</ol>
<p>After you copy the function to the same location as your code, load it into your code by adding this to the top of your code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">near_regex</span> <span class="kn">import</span> <span class="n">NEAR_regex</span> <span class="c1"># yes, the font case is different</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>At the bottom of the near_regex.py file, I included examples. You don’t need to keep these and if you do, it will cause your code to print stuff. This will be confusing to someone reading the code. So when you copy near_regex.py into a folder to use it, delete all the examples and stuff below the “return” line in the function.</p>
</div>
<div class="section" id="demo">
<h2><span class="section-number">4.4.4.1. </span>Demo<a class="headerlink" href="#demo" title="Permalink to this headline">¶</a></h2>
<p>Let me start by showing you some examples. After these examples, load the function and read the help documentation in it, and then we can do some practice.</p>
<p>Each example looks inside a document (here, the “document” is just a short sentence) for some words.</p>
<p>To use this function:</p>
<ol class="simple">
<li><p>Load your document and clean the string</p></li>
<li><p>Create a list of strings you want to look for. The function will create a (complex) regex pattern that will detect if all of the strings are near each other in the document.</p></li>
<li><p>Give the list of strings (from step 2) to the function to create the regex pattern.</p></li>
<li><p>Use the pattern (from step 3) to</p>
<ul class="simple">
<li><p>Count how many times the pattern hits</p></li>
<li><p>Print out the text matches to check the text</p></li>
</ul>
</li>
</ol>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">NEAR_regex</span><span class="p">(</span><span class="n">list_of_words</span><span class="p">,</span><span class="n">max_words_between</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">partial</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">cases_matter</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    list_of_words : list</span>
<span class="sd">        A list of &quot;words&quot;, each element is a string</span>
<span class="sd">        </span>
<span class="sd">        This program will return a regex that will look for times where word1 </span>
<span class="sd">        is near word2, or word2 is near word 1.</span>
<span class="sd">        </span>
<span class="sd">        It works with multiple words: You can see if words1 is near word2 or</span>
<span class="sd">        word3. </span>
<span class="sd">        </span>
<span class="sd">    max_words_between : int, optional</span>
<span class="sd">        How many &quot;words&quot; are allowed between words in list_of_words. The default</span>
<span class="sd">        is 5, but you should consider this carefully.</span>
<span class="sd">        </span>
<span class="sd">        &quot;words&quot; in between are chunks of characters. &quot;DON don don- don12 2454&quot; </span>
<span class="sd">        is 5 words.</span>
<span class="sd">        </span>
<span class="sd">        This will not allow matches if the words are separated by a newline </span>
<span class="sd">        (&quot;\n&quot;) character.</span>
<span class="sd">        </span>
<span class="sd">    partial : Boolean, optional</span>
<span class="sd">        If true, will accept longer words than you give. For example, if one </span>
<span class="sd">        word in your list is &quot;how&quot;, it will match to &quot;howdy&quot;. Be careful in </span>
<span class="sd">        choosing this based on your problem. Partial makes more sense with </span>
<span class="sd">        longer words. </span>
<span class="sd">        The default is True.</span>
<span class="sd">        </span>
<span class="sd">    cases_matter: Boolean, optional bt IMPORTANT</span>
<span class="sd">        If True, will return a regex string that will only catch cases where  </span>
<span class="sd">        words in the string have the same case as given as input to this </span>
<span class="sd">        function. For example, if one word here is &quot;Hi&quot;, then the regex </span>
<span class="sd">        produced by this function will not catch &quot;hi&quot;.</span>
<span class="sd">        </span>
<span class="sd">        If false, will return a regex string that will only work if all letters</span>
<span class="sd">        in search string are lowercase.</span>
<span class="sd">        </span>
<span class="sd">        The default is True.</span>
<span class="sd">     </span>
<span class="sd">    Warning</span>
<span class="sd">    -------</span>
<span class="sd">    See the last example. The regex is minimally greedy. </span>
<span class="sd">    </span>
<span class="sd">       </span>
<span class="sd">    Feature Requests (participation credit available)</span>
<span class="sd">    -------</span>
<span class="sd">    1. A wrapper that takes the above inputs, the string to search, and a variable=count|text, and</span>
<span class="sd">    returns either the number of hits or the text of the matching elements. (See the examples below.)</span>
<span class="sd">    </span>
<span class="sd">    2. Optionally clean the string before the regex stuff happens.</span>
<span class="sd">    </span>
<span class="sd">    3. Optionally ignore line breaks. </span>
<span class="sd">    </span>
<span class="sd">    4. Optionally make it lazy (in the last example, </span>
<span class="sd">    the &quot;correct&quot; answer is probably 2, but it gives 1.)</span>
<span class="sd">    </span>
<span class="sd">        </span>
<span class="sd">    Unsure about speed</span>
<span class="sd">    -------</span>
<span class="sd">    I don&#39;t think this is a very &quot;fast&quot; function, but it should be robust. </span>
<span class="sd">  </span>
<span class="sd">    </span>
<span class="sd">    Suggested use</span>
<span class="sd">    -------</span>
<span class="sd">    # clean your starting string </span>
<span class="sd">    a_string_you_have = &#39;jack and jill went up the hill&#39;</span>
<span class="sd">    </span>
<span class="sd">    # 1. define words and set up the regex</span>
<span class="sd">    words = [&#39;jack&#39;,&#39;hill&#39;]                         </span>
<span class="sd">    rgx = NEAR_regex(words)                       </span>
<span class="sd">    </span>
<span class="sd">    # 2a. count the number of times the word groups are in the text near each other</span>
<span class="sd">    count = len(re.findall(rgx,a_string_you_have))              </span>
<span class="sd">    print(count)  </span>
<span class="sd">    </span>
<span class="sd">    # 2b. print the actual text matches &lt;-- great for checking!</span>
<span class="sd">    text_of_matches = [m.group(0) for m in re.finditer(rgx,a_string_you_have)]</span>
<span class="sd">    print(text_of_matches)</span>

<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A string which is a regex that can be used to look for cases where all the </span>
<span class="sd">    input words are near each other.</span>

<span class="sd">    &#39;&#39;&#39;</span>
               
    <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">permutations</span>
    
    <span class="n">start</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(?:\b&#39;</span> <span class="c1"># the r means &quot;raw&quot; as in the backslash is just a backslash, not an escape character</span>
    
    <span class="k">if</span> <span class="n">partial</span><span class="p">:</span>
        <span class="n">gap</span>   <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;[A-Za-z]*\b(?: +[^ \n\r]*){0,&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">max_words_between</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;} *\b&#39;</span>
        <span class="n">end</span>   <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;[A-Za-z]*\b)&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gap</span>   <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\b(?: +[^ \n]*){0,&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">max_words_between</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;} *\b&#39;</span>
        <span class="n">end</span>   <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\b)&#39;</span>
        
    <span class="n">regex_list</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">permu</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">permutations</span><span class="p">(</span><span class="n">list_of_words</span><span class="p">)):</span>
        <span class="c1"># catch this permutation: start + word + gap (+ word + gap)... + end</span>
        <span class="k">if</span> <span class="n">cases_matter</span><span class="p">:</span> <span class="c1"># case sensitive - what cases the user gives are given back</span>
              <span class="n">regex_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start</span><span class="o">+</span><span class="n">gap</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">permu</span><span class="p">)</span><span class="o">+</span><span class="n">end</span><span class="p">)</span>           
        <span class="k">else</span><span class="p">:</span> <span class="c1"># the resulting search will only work if all words are lowercase</span>
            <span class="n">lowerpermu</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">permu</span><span class="p">]</span>
            <span class="n">regex_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start</span><span class="o">+</span><span class="n">gap</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lowerpermu</span><span class="p">)</span><span class="o">+</span><span class="n">end</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">regex_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Is the word “part” near the word “with” in this string? No:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">near_regex</span> <span class="kn">import</span> <span class="n">NEAR_regex</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="n">test</span>  <span class="o">=</span> <span class="s1">&#39;This is a partial string another break with words&#39;</span>
<span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;part&#39;</span><span class="p">,</span><span class="s1">&#39;with&#39;</span><span class="p">]</span>
<span class="n">rgx</span>   <span class="o">=</span> <span class="n">NEAR_regex</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">rgx</span><span class="p">,</span><span class="n">test</span><span class="p">)))</span>            <span class="c1"># no match (partials not allowed by default) </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<p>But we can use <code class="docutils literal notranslate"><span class="pre">partial=True</span></code> in the function which will look for any words starting with “part” (partial, partly, etc) and “with” (without, withhold, etc). Be careful using <code class="docutils literal notranslate"><span class="pre">partial=True</span></code>, as it can lead to too many matches, and ones you don’t want.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rgx</span> <span class="o">=</span> <span class="n">NEAR_regex</span><span class="p">(</span><span class="n">words</span><span class="p">,</span><span class="n">partial</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">rgx</span><span class="p">,</span><span class="n">test</span><span class="p">)))</span>            <span class="c1"># match (partials allowed) </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
</pre></div>
</div>
</div>
</div>
<p>You can change how many words can be between the search terms. Shorter distances means the terms are more likely to be related grammatically. For example, <code class="docutils literal notranslate"><span class="pre">max_words_between=3</span></code> might be used if you want to find an adjective directly modifying a noun (but with the allowance that it might be in a list of adjectives). Higher values are more useful if you want to see if two ideas (nouns) are in the same sentence or paragraph.</p>
<p>In our example, “partial” and “with” are several words apart, so this correctly returns a value of zero:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rgx</span>   <span class="o">=</span> <span class="n">NEAR_regex</span><span class="p">(</span><span class="n">words</span><span class="p">,</span><span class="n">partial</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">max_words_between</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">rgx</span><span class="p">,</span><span class="n">test</span><span class="p">)))</span>            <span class="c1"># no match (too far apart) </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<div class="note admonition">
<p class="admonition-title">Two caveats:</p>
<ol class="simple">
<li><p>This is a “dumb” function in the sense that it doesn’t do anything to actually detect if two words are in the same sentence or paragraph. There are ways to do that, but we’re going to keep it simple and just stick to this function as-is. Let’s assume that a sentence is about 20 words on average, and a paragraph is 200 words on average.</p></li>
<li><p>In the next two examples: If your document has line breaks, like a newline symbol (“\n”) or a return symbol (“\r”), which create paragraph breaks in a document, this function <em>won’t</em> search both sides of it. If a document splits paragraphs like this, great: our function will do within-paragraph searching, <strong>as long as our cleaning process doesn’t delete those symbols.</strong> However, some documents have those symbols at the end of every single line and we need to delete them while cleaning, in which case, we can’t assume the function only looks within paragraphs.</p></li>
</ol>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test</span>  <span class="o">=</span> <span class="s1">&#39;This is a partial string </span><span class="se">\n</span><span class="s1"> another break with words&#39;</span>
<span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;part&#39;</span><span class="p">,</span><span class="s1">&#39;with&#39;</span><span class="p">]</span>
<span class="n">rgx</span> <span class="o">=</span> <span class="n">NEAR_regex</span><span class="p">(</span><span class="n">words</span><span class="p">,</span><span class="n">partial</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">rgx</span><span class="p">,</span><span class="n">test</span><span class="p">)))</span>            <span class="c1"># fails because of the \n break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test</span>  <span class="o">=</span> <span class="s1">&#39;This is a partial string </span><span class="se">\r</span><span class="s1"> another break with words&#39;</span>
<span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;part&#39;</span><span class="p">,</span><span class="s1">&#39;with&#39;</span><span class="p">]</span>
<span class="n">rgx</span> <span class="o">=</span> <span class="n">NEAR_regex</span><span class="p">(</span><span class="n">words</span><span class="p">,</span><span class="n">partial</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">rgx</span><span class="p">,</span><span class="n">test</span><span class="p">)))</span>            <span class="c1"># fails with \r too.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test</span>  <span class="o">=</span> <span class="s1">&#39;This is a partial string                      another break with words&#39;</span>
<span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;part&#39;</span><span class="p">,</span><span class="s1">&#39;with&#39;</span><span class="p">]</span>
<span class="n">rgx</span> <span class="o">=</span> <span class="n">NEAR_regex</span><span class="p">(</span><span class="n">words</span><span class="p">,</span><span class="n">partial</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">rgx</span><span class="p">,</span><span class="n">test</span><span class="p">)))</span>            <span class="c1"># extra spaces are treated as one space, no impact</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">cases_matter</span></code> parameter is pretty simple. If true, then it only reports a match if the string’s case exactly match how you typed your search terms.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;part&#39;</span><span class="p">,</span><span class="s1">&#39;With&#39;</span><span class="p">]</span>                     <span class="c1"># changed to Capitalized &quot;With&quot;</span>
<span class="n">rgx</span>   <span class="o">=</span> <span class="n">NEAR_regex</span><span class="p">(</span><span class="n">words</span><span class="p">,</span><span class="n">partial</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">cases_matter</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">rgx</span><span class="p">,</span><span class="n">test</span><span class="p">)))</span>            <span class="c1"># no match</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<p>You can look for three terms that all have to be next to each other:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;part&#39;</span><span class="p">,</span><span class="s1">&#39;with&#39;</span><span class="p">,</span><span class="s1">&#39;this&#39;</span><span class="p">]</span>
<span class="n">rgx</span> <span class="o">=</span> <span class="n">NEAR_regex</span><span class="p">(</span><span class="n">words</span><span class="p">,</span><span class="n">partial</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">rgx</span><span class="p">,</span><span class="n">test</span><span class="p">)))</span>            <span class="c1"># no match - good! &quot;This&quot; != &quot;this&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">rgx</span><span class="p">,</span><span class="n">test</span><span class="o">.</span><span class="n">lower</span><span class="p">())))</span>    <span class="c1"># match - good!</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
1
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="tips">
<h2><span class="section-number">4.4.4.2. </span>Tips<a class="headerlink" href="#tips" title="Permalink to this headline">¶</a></h2>
<div class="tip admonition">
<p class="admonition-title"><strong>Is topic1 near topic2 (instead of word1 near word2)?</strong></p>
<p><strong>The function doesn’t just look for words that are near each other. It looks to see if <em>regex patterns</em> are near each other.</strong></p>
<p>Above, I said that NEAR_regex builds “a (complex) regex pattern that will detect if all of the <strong>strings</strong> are near each other in the document.”  What it is actually doing is putting the strings into a regex. In our examples so far, the strings are always a word. But your list of search terms can include “mini-regexs”. The most common use: You want to look for a topic (a word) but make sure it is being used in a specific way.</p>
</div>
<p>Suppose we want to know if a text message chain involves a greeting <em>specifically</em> for James but not John? But annoyingly, James is sometimes referred to by a nickname!</p>
<p>Well, we’d want to build a search that looks for:</p>
<ol class="simple">
<li><p>A greeting term: “hey” OR “hi” or “sup”.</p></li>
<li><p>James’ name and nicknames: “james” OR “jimmy”</p></li>
</ol>
<p>So we can exploit how regex works so that when we specify the <code class="docutils literal notranslate"><span class="pre">words</span> <span class="pre">=</span> <span class="pre">[element1,</span> <span class="pre">element2]</span></code> list, that</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">element1</span></code> is the list of greeting terms.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">element2</span></code> is the list of acceptable names.</p></li>
</ol>
<p>**To build a regex that looks for “hey” OR “hi” or “sup”, we need to implement these three things:</p>
<ul class="simple">
<li><p>In regex, OR is “|”.</p></li>
<li><p>No spaces between terms</p></li>
<li><p>*<em>Important:</em> Put the parentheses around the whole set of terms!</p></li>
</ul>
<p>So, “hey” OR “hi” or “sup” becomes <code class="docutils literal notranslate"><span class="pre">'(hey|hi|sup)'</span></code>.</p>
<p>Constructing a search like this allows you to look for a topic (here, the greeting term) being used in a specific way. Examples:</p>
<ol class="simple">
<li><p>The cost (term 1) of building factories (term 2)… but not general costs or costs for other items</p></li>
<li><p>Discussions of risks (term 1) from particular sources like floods (term 2)… but not general risks like competition</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">texts</span>  <span class="o">=</span> <span class="s1">&#39;hey jimmy                      hi james          sup john&#39;</span>
<span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;(hey|hi|sup)&#39;</span><span class="p">,</span><span class="s1">&#39;(jimmy|james)&#39;</span><span class="p">]</span>     <span class="c1"># search for a greeting </span>
<span class="n">rgx</span> <span class="o">=</span> <span class="n">NEAR_regex</span><span class="p">(</span><span class="n">words</span><span class="p">,</span><span class="n">max_words_between</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">rgx</span><span class="p">,</span><span class="n">texts</span><span class="p">)))</span>            <span class="c1"># both are caught</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2
</pre></div>
</div>
</div>
</div>
<div class="tip admonition">
<p class="admonition-title">Printing out your matches</p>
<p>This is very useful to double-check what your search is finding!</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">rgx</span><span class="p">,</span><span class="n">texts</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;hey jimmy&#39;, &#39;hi james&#39;]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="caveats">
<h2><span class="section-number">4.4.4.3. </span>Caveats<a class="headerlink" href="#caveats" title="Permalink to this headline">¶</a></h2>
<div class="warning admonition">
<p class="admonition-title">Two caveats</p>
<p><strong>Caveat One:</strong> When a regex finds a match, the part of that string in the match can’t be used again and thus won’t be counted. Above, you could argue that mechanically, there are FOUR matches:</p>
<ol class="simple">
<li><p>hey jimmy</p></li>
<li><p>jimmy hi</p></li>
<li><p>hi james</p></li>
<li><p>james sup</p></li>
</ol>
<p>But the “hey jimmy” match “uses up” “jimmy”, so “jimmy hi” can’t be found. Same with matches #3 and #4.</p>
<p><strong>Caveat Two:</strong> The function is “greedy”. Look at the next example, where I allow there to be two words between.</p>
<p>Starting from “hey”, it finds “jimmy” right away, but it doesn’t stop. (That would be a “lazy” regex.) It keeps looking since it can look up to three words away. It takes the largest mechanical match possible, so when it finds james, it deems “hey jimmy hi james” a match, and because of that, “hi james” is already used and can’t be a match. So it reports 1 match, not 2.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rgx</span> <span class="o">=</span> <span class="n">NEAR_regex</span><span class="p">(</span><span class="n">words</span><span class="p">,</span><span class="n">max_words_between</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">rgx</span><span class="p">,</span><span class="n">texts</span><span class="p">)))</span>            <span class="c1"># the regex isn&#39;t greedy - it misses inner matches!</span>
<span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">rgx</span><span class="p">,</span><span class="n">texts</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;hey jimmy                      hi james&#39;]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="practice">
<h2><span class="section-number">4.4.4.4. </span>Practice<a class="headerlink" href="#practice" title="Permalink to this headline">¶</a></h2>
<p>Let’s use Telsa. Copy this code into an empty notebook, and put the near_regex.py file in the same folder.</p>
<p>Let’s see how many times the document mentions China in the context of three issues:</p>
<ol class="simple">
<li><p>political considerations (broadly, and specific risks)</p></li>
<li><p>rare earth elements</p></li>
<li><p>supply chains, import tariffs</p></li>
</ol>
<p>I strongly suggest approaching this by using two terms.  You might need to have multiple words in each term.</p>
<ol class="simple">
<li><p>Print out the text of the hits!</p></li>
<li><p>Play around with partial and the max parameters. Specifically look for when changing them gives you BAD results: Either way too many non-results are included, or your search returns too few results because a single hit encompasses several hits that should be separately counted</p></li>
<li><p>Try to get the “most accurate” sense of</p>
<ol class="simple">
<li><p>Does the document discuss each issue at all? Is the number of hits 0, or &gt;0?</p></li>
<li><p>How much does the document discuss the issue? How many hits?</p></li>
</ol>
</li>
<li><p>Does the number of hits reflect the scale of the issue? Why or why not?</p></li>
<li><p>If not, is there a way to transform the number of hits to reflect the scale? Some ideas:</p>
<ul class="simple">
<li><p>Going from 1 to 2 hits is probably more informative than from 99 hits to 100</p></li>
<li><p>If you use ln(hits), ln(2)-ln(1) is more than ln(100)-ln(99)</p></li>
<li><p>Try to use ln(hits) and see if you spot a problem! What’s a fix you can use?</p></li>
<li><p>Binning: no discussion (hits=0), some discussion (hits&lt;=#), lots of discussion (hits&gt;#)</p></li>
<li><p>How many bins and how you set the cutoffs is ad hoc and depends on the documents and topics!</p></li>
</ul>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.sec.gov/Archives/edgar/data/1318605/000156459019003165/0001564590-19-003165.txt&#39;</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c1"># putting the &quot;Good ideas&quot; from 4.4 to work to clean the document:</span>
<span class="n">lower</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="n">no_punc</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\W&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="n">lower</span><span class="p">)</span>
<span class="n">cleaned</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="n">no_punc</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># copy the function into your working directory next to this file</span>
<span class="kn">from</span> <span class="nn">near_regex</span> <span class="kn">import</span> <span class="n">NEAR_regex</span> 
<span class="c1"># if this prints numbers, that means you havent deleted the examples inside near_regex.py. delete em</span>

<span class="n">help</span><span class="p">(</span><span class="n">NEAR_regex</span><span class="p">)</span> <span class="c1"># look at and read the documentation!</span>

<span class="c1"># try to use NEAR_regex... look for it working and failing...</span>
</pre></div>
</div>
</div>
</div>
<hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="best"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p><img alt="best" src="https://memegenerator.net/img/instances/82084173/oh-my-gosh-youre-the-best.jpg" /></p>
</dd>
</dl>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./content/04"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="02c_developing_a_regex.html" title="previous page"><span class="section-number">4.4.3. </span>Developing a regex</a>
    <a class='right-next' id="next-link" href="../05/00_intro.html" title="next page"><span class="section-number">5. </span>Data Science for Finance</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Prof. Donald Bowen<br/>
        
            &copy; Copyright 2024.<br/>
          <div class="extra_footer">
            You're doing well, keep going!
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>